# latexmkrc configuration for SageTeX
# Place this file in your project directory or ~/.latexmkrc

# SageTeX custom dependency
# This tells latexmk: "If a .sout file is missing or older than
# the .sagetex.sage file, run the makesage subroutine"

add_cus_dep('sagetex.sage', 'sout', 0, 'makesage');

sub makesage {
    my $base = shift;
    # Remove the .sagetex from the base name for the actual file
    return system("sage '$base.sagetex.sage'");
}

# Alternative simpler form:
# add_cus_dep('sagetex.sage', 'sout', 0, 'sage');

# PythonTeX custom dependency (if using latexmk with PythonTeX)
add_cus_dep('pytxcode', 'pytxmcr', 0, 'makepythontex');

sub makepythontex {
    my $base = shift;
    return system("pythontex '$base'");
}

# PDF mode by default
$pdf_mode = 1;

# Use pdflatex
$pdflatex = 'pdflatex -interaction=nonstopmode -synctex=1 %O %S';

# Clean up auxiliary files
$clean_ext = 'pytxcode pytxmcr sagetex.sage sagetex.scmd sout sympy';
